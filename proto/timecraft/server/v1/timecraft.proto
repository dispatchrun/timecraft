syntax = "proto3";

package timecraft.server.v1;

message ModuleSpec {
  string path = 1;
  repeated string args = 2;
}

message HTTPRequest {
  string method = 1;
  string path = 2;
  repeated Header headers = 3;
  bytes body = 4;
}

message Header {
  string name = 1;
  string value = 2;
}

message SubmitTaskRequest {
  ModuleSpec module = 1;
  HTTPRequest request = 2;
}

message SubmitTaskResponse {
  string task_id = 1;
}

message LookupTaskRequest {
  string task_id = 1;
}

enum TaskState {
  TASK_STATE_UNSPECIFIED = 0; // buf lint complains if this isn't here..
  TASK_STATE_QUEUED = 1;
  TASK_STATE_INITIALIZING = 2;
  TASK_STATE_EXECUTING = 3;
  TASK_STATE_ERROR = 4;
  TASK_STATE_DONE = 5;
}

message LookupTaskResponse {
  TaskState state = 1;
}

message VersionRequest {}

message VersionResponse {
  string version = 1;
}

service TimecraftService {
  rpc SubmitTask(SubmitTaskRequest) returns (SubmitTaskResponse) {}
  rpc LookupTask(LookupTaskRequest) returns (LookupTaskResponse) {}
  rpc Version(VersionRequest) returns (VersionResponse) {}
}
